#include "xgpio.h"
#include "xscutimer.h"
#include "xscugic.h"
#include  "interrupt_handler.h"
#include "clock.h"
#include "stdio.h"
#include "xil_cache.h"
#include "data_handle.h"


extern XGpio dip, push,led, led_count;
int psb_check, dip_check, dip_check_prev, count;


// Global inherited variables
extern XScuTimer_Config *ConfigPtr;
extern XScuTimer Timer;		/* Cortex A9 SCU Private Timer Instance */
extern XScuTimer *TimerInstancePtr;


static int Init_Peripherals();
void FormatDate(Time time, char* buffer);
void FormatTime(Time time, char* buffer);

int main(){


}


int Init_Peripherals(){
	int xResult = IO_Initialize();


	// Initialize the timer
	ConfigPtr = XScuTimer_LookupConfig (XPAR_PS7_SCUTIMER_0_DEVICE_ID);
	xResult = XScuTimer_CfgInitialize(&Timer, ConfigPtr, ConfigPtr->BaseAddr);
	if (xResult != XST_SUCCESS){
		xil_printf("Timer init() failed\r\n");
		return XST_FAILURE;
	}
	return xResult;
}

void DisableCaches() {
   Xil_DCacheFlush();
   Xil_DCacheDisable();
   Xil_ICacheInvalidate();
   Xil_ICacheDisable();
}

void EnableCaches(){
	Xil_ICacheEnable();
	Xil_DCacheEnable();
}


void FormatDate(Time time, char* buffer) {
    int intYear = bcd2int(time.year); // Convert BCD to integer, if necessary
    // Format date - Day Month/Date/Year
    snprintf(buffer, 30, "%s %x/%x/%04d", weekdays[time.day], time.month, time.date, intYear + 2000);
}

void FormatTime(Time time, char* buffer) {
   // Format time - hour:minute AM/PM
   if (time.ampm) {
      snprintf(buffer, 20, "%x:%02x:%02x PM", time.hour, time.minute,time.second);
   } else {
      snprintf(buffer, 20, "%x:%02x:%02x AM", time.hour, time.minute,time.second);
   }
}
